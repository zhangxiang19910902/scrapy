import time

import requests
from pymongo import MongoClient

client = MongoClient('mongodb://localhost:27017/')
db2 = client.name.zx_0927_crmwbench

cookies = {
    'proUserToken': 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyNzc1MCIsImV4cCI6MTY5NjAwNTQ2MH0.Mwh-GSBobX2HIcW6tQHugxue9gquxRFM-q6OgUKQWbE',
}

headers = {
    'authority': 'crmwbench.hqjy.com',
    'accept': 'application/json, text/plain, */*',
    'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'content-type': 'application/json;charset=UTF-8',
    # 'cookie': 'proUserToken=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyNzc1MCIsImV4cCI6MTY5NjAwNTQ2MH0.Mwh-GSBobX2HIcW6tQHugxue9gquxRFM-q6OgUKQWbE',
    'origin': 'https://crmwbench.hqjy.com',
    'referer': 'https://crmwbench.hqjy.com//',
    'sec-ch-ua': '"Google Chrome";v="117", "Not;A=Brand";v="8", "Chromium";v="117"',
    'sec-ch-ua-mobile': '?0',
    'sec-ch-ua-platform': '"Windows"',
    'sec-fetch-dest': 'empty',
    'sec-fetch-mode': 'cors',
    'sec-fetch-site': 'same-origin',
    'token': 'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIyNzc1MCIsImV4cCI6MTY5NjAwNTQ2MH0.Mwh-GSBobX2HIcW6tQHugxue9gquxRFM-q6OgUKQWbE',
    'user-agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36',
}

params = {
    '_t': '1695919145',
}


num = 0

for a in range(249,383):
    json_data = {
        'dealDeptIdList': [
            4640,
            5657,
            4587,
            4588,
            4589,
            4590,
            5675,
            5480,
            5481,
            5535,
            5676,
            5482,
            5537,
            5677,
            5483,
            5484,
            5678,
            5634,
            5635,
            4611,
            4612,
            5672,
            5436,
            5437,
            5438,
            5439,
            5440,
            5441,
            5442,
            5536,
            5538,
            5554,
            5779,
            5658,
            5679,
            5623,
            5680,
            5627,
            5628,
            5629,
            5681,
            5631,
            5682,
            5630,
            5683,
            5512,
            5513,
            5514,
            5515,
            5684,
            5506,
            5507,
            5508,
            5509,
            5510,
            5511,
            5685,
            5632,
            5686,
            5633,
            5687,
            5622,
            5638,
            5639,
            5503,
            5504,
            5505,
            5636,
            5637,
            5659,
            5688,
            5516,
            5517,
            5689,
            5624,
            5656,
            5660,
            5690,
            5527,
            5528,
            5691,
            5595,
            5692,
            5526,
            5693,
            5594,
            5694,
            5596,
            5661,
            5695,
            5472,
            5473,
            5474,
            5475,
            5476,
            5477,
            5478,
            5479,
            5570,
            5576,
            5578,
            5769,
            5600,
            5770,
            5601,
            5605,
            5771,
            5609,
            5612,
            5772,
            5592,
            5778,
            5602,
            5773,
            5613,
            5777,
            5593,
            5662,
            5696,
            5423,
            5424,
            5425,
            5426,
            5427,
            5428,
            5429,
            5430,
            5533,
            5558,
            5569,
            5697,
            5610,
            5611,
            5698,
            5597,
            5598,
            5699,
            5588,
            5700,
            5701,
            5603,
            5606,
            5607,
            5702,
            5589,
            5703,
            5471,
            5534,
            5704,
            5590,
            5591,
            5663,
            5705,
            5463,
            5464,
            5465,
            5466,
            5467,
            5468,
            5469,
            5470,
            5530,
            5532,
            5555,
            5706,
            5539,
            5707,
            5540,
            5708,
            5541,
            5709,
            5542,
            5710,
            5543,
            5711,
            5617,
            5712,
            5501,
            5502,
            5713,
            5544,
            5545,
            5714,
            5546,
            5715,
            5547,
            5716,
            5616,
            5548,
            5664,
            5717,
            5599,
            5718,
            5524,
            5719,
            5583,
            5720,
            5525,
            5721,
            5584,
            5722,
            5604,
            5651,
            5723,
            5585,
            5586,
            5587,
            5529,
            5521,
            5522,
            5552,
            5654,
            5665,
            5724,
            5581,
            5725,
            5580,
            5726,
            5518,
            5519,
            5727,
            5579,
            5728,
            5582,
            5729,
            5520,
            5666,
            5730,
            5416,
            5417,
            5418,
            5419,
            5420,
            5422,
            5421,
            5731,
            5572,
            5732,
            5567,
            5733,
            5486,
            5531,
            5734,
            5648,
            5735,
            5645,
            5736,
            5571,
            5737,
            5485,
            5738,
            5644,
            5667,
            5739,
            5559,
            5560,
            5740,
            5641,
            5642,
            5741,
            5647,
            5742,
            5575,
            5743,
            5561,
            5744,
            5640,
            5745,
            5460,
            5461,
            5746,
            5487,
            5488,
            5747,
            5573,
            5574,
            5668,
            5748,
            5618,
            5749,
            5443,
            5445,
            5446,
            5447,
            5750,
            5620,
            5751,
            5549,
            5669,
            5752,
            5614,
            5753,
            5621,
            5754,
            5615,
            5619,
            5649,
            5650,
            5755,
            5760,
            5494,
            5495,
            5496,
            5761,
            5562,
            5762,
            5646,
            5763,
            5563,
            5564,
            5643,
            5756,
            5764,
            5462,
            5553,
            5557,
            5757,
            5765,
            5565,
            5758,
            5766,
            5497,
            5767,
            5566,
            5759,
            5768,
            5498,
            5499,
            5500,
            5568,
            5774,
            5670,
            5489,
            5490,
            5491,
            5492,
            5493,
            5577,
            5653,
            5655,
            5775,
            5671,
            5448,
            5449,
            5450,
            5451,
            5452,
            5453,
            5454,
            5455,
            5456,
            5457,
            5458,
            5459,
            5776,
            5673,
            5431,
            5432,
            5433,
            5434,
            5435,
            5550,
            5551,
            3020,
            3021,
            4111,
            4112,
            4113,
            4114,
            4501,
            4506,
            2820,
            2822,
            2823,
            4507,
            3463,
            4508,
            3970,
            4509,
            3465,
            3466,
            3963,
        ],
        'pageNum': a,
        'pageSize': 100,
        'total': 0,
        'sortItems': [
            {
                'asc': False,
                'column': 'createTime',
            },
        ],
    }
    while True:
        try:
            response = requests.post(
                'https://crmwbench.hqjy.com/qw_new_api/order/ty/order/orderListPage',
                params=params,
                cookies=cookies,
                headers=headers,
                json=json_data,
            )
            if response.status_code ==200:
                break
            else:
                print(response.status_code)
        except:
            print("程序报错")
    res_json = response.json()

    for b in res_json['result']['list']:
        db_dict = {}
        db_dict['订单号'] = b.get("orderNo")
        db_dict['学员姓名'] = b.get("userName")
        db_dict['学员学历'] = b.get("educationName")
        db_dict['报读商品'] = b.get("goodsName")
        db_dict['产品线'] = b.get("productName")
        db_dict['学历班型'] = b.get("isClassTypeName")
        db_dict['商品价格'] = b.get("amountPayable")
        db_dict['应收金额'] = b.get("payPrice")
        db_dict['已收价格'] = b.get("amountReceived")
        db_dict['未回款金额'] = b.get("collectedMoney")
        db_dict['订单状态'] = b.get("orderStatusName")
        db_dict['协议状态'] = b.get("signContractStatusName")
        db_dict['学习状态'] = b.get("studyStatusName")
        db_dict['销售老师'] = ''
        db_dict['招生老师'] = b.get("teacherRecruitName")
        db_dict['是否收齐款'] = b.get("allPayName")
        db_dict['转介绍'] = b.get("isRecommandName")
        db_dict['转介绍老师'] = b.get("teacherRecommandName")
        db_dict['商机赛道'] = b.get("trackTypeName")
        db_dict['成交时间'] = b.get("createTime")
        db_dict['报名校区'] = b.get("subscribeSchoolName")
        db_dict['上课校区'] = b.get("signSchoolName")
        db_dict['渠道名称'] = b.get("channelsTypeName")
        db_dict['身份证'] = b.get("idCard")

        customerId = b.get("customerId")
        orderId = b.get("id")
        params = {
            'customerId': customerId,
            'orderId': orderId,
            '_t': '1695919145',
        }
        time.sleep(1.5)
        response1 = requests.get(
            'https://crmwbench.hqjy.com/qw_new_api/order/ty/order/tySeePhone',
            params=params,
            cookies=cookies,
            headers=headers,
        ).json()

        phone = response1.get('result')

        db_dict['手机号'] = phone
        db2.insert_one(db_dict)
        num += 1
        print(f'添加{num}条成功')
